#!/bin/bash

# Check if a domain is provided
if [ -z "$1" ]; then
  echo "Usage: $0 <domain>"
  exit 1
fi

DOMAIN=$1
PORT=443

# Fetch and display SSL certificate details
echo "Fetching SSL certificate details for $DOMAIN..."

CERT_INFO=$(echo | openssl s_client -servername $DOMAIN -connect $DOMAIN:$PORT 2>/dev/null | openssl x509 -noout -issuer -subject -dates -serial -fingerprint)

if [ -z "$CERT_INFO" ]; then
  echo "Unable to retrieve SSL certificate information. The website may not have an SSL certificate or may not be accessible."
  exit 1
fi

echo "$CERT_INFO"

# Extract the expiration date
EXPIRY_DATE=$(echo "$CERT_INFO" | grep 'notAfter=' | cut -d= -f2)
CURRENT_DATE=$(date -u "+%Y-%m-%d %H:%M:%S")

# Convert dates to seconds since epoch
EXPIRY_DATE_SEC=$(date -u -d "$EXPIRY_DATE" "+%s")
CURRENT_DATE_SEC=$(date -u -d "$CURRENT_DATE" "+%s")

# Calculate days until expiry
DAYS_UNTIL_EXPIRY=$(( ($EXPIRY_DATE_SEC - $CURRENT_DATE_SEC) / 86400 ))

echo "The SSL certificate for $DOMAIN will expire on $EXPIRY_DATE ($DAYS_UNTIL_EXPIRY days remaining)."
